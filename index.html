<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mohammed Ghouse | BI Architect</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --apple-bg: #F5F5F7; --apple-card: #FFFFFF; --apple-text-pri: #000000;
            --apple-footer-grey: #6E6E73; --apple-border: #D2D2D7; --radius: 22px;
            --color-bg: var(--apple-bg); --color-surface: var(--apple-card);
        }
        .dark-mode {
            --apple-bg: #000000; --apple-card: #1C1C1E; --apple-text-pri: #FFFFFF;
            --apple-footer-grey: #A1A1A6; --apple-border: #38383A;
        }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--color-bg);
            color: var(--apple-text-pri); transition: all 0.4s ease; margin: 0;
        }
        .admin-only { display: none !important; }
        body.is-admin .admin-only { display: inline-flex !important; }
        body.is-admin .admin-only-flex { display: flex !important; }
        .nav-glass { background: var(--color-bg); backdrop-filter: blur(20px); border-bottom: 1px solid var(--apple-border); position: sticky; top: 0; z-index: 1000; padding: 14px 40px; }
        .apple-card { background: var(--color-surface); border-radius: var(--radius); padding: 40px; border: 1px solid var(--apple-border); transition: all 0.4s ease; position: relative; overflow: hidden; height: 100%; }
        .portrait-frame { width: 100%; max-width: 480px; height: 600px; background: #E8E8ED; border-radius: var(--radius); overflow: hidden; position: relative; border: 1px solid var(--apple-border); }
        .portrait-frame img { width: 100%; height: 100%; object-fit: cover; }
        .visual-viewport { width: 100%; aspect-ratio: 16/10; background: #E8E8ED; border-radius: 12px; overflow: hidden; position: relative; border: 1px solid var(--apple-border); margin-bottom: 20px; }
        .visual-viewport img { width: 100%; height: 100%; object-fit: cover; }
        .apple-button { background: var(--apple-text-pri); color: var(--color-bg) !important; padding: 12px 32px; border-radius: 980px; font-weight: 700; cursor: pointer; }
        .mgmt-hub { position: absolute; inset: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.3s; }
        .apple-card:hover .mgmt-hub, .portrait-frame:hover .mgmt-hub { opacity: 1; }
        #loading-overlay { position: fixed; inset: 0; background: var(--apple-bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.6s; }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="w-12 h-12 border-2 border-neutral-300 border-t-neutral-800 rounded-full animate-spin mb-4"></div>
    <span class="text-xs font-bold tracking-widest">CONNECTING TO CLOUD...</span>
</div>

<nav class="nav-glass">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
        <div class="flex items-center gap-4">
            <span class="font-extrabold text-lg">Mohammed Ghouse</span>
            <span class="text-[10px] font-bold uppercase opacity-50">BI Architect</span>
        </div>
        <div class="flex items-center gap-6">
            <button onclick="toggleTheme()" class="text-[10px] font-bold uppercase tracking-widest">Theme</button>
            <span id="lock-trigger" onclick="handleLockClick()" class="w-2 h-2 bg-neutral-400 rounded-full cursor-pointer"></span>
        </div>
    </div>
    <div class="admin-only max-w-7xl mx-auto mt-4 pt-4 border-t border-neutral-200 flex gap-4">
        <button id="save-btn" onclick="saveToCloud()" class="text-[10px] bg-black text-white px-4 py-1.5 rounded-full font-bold">DEPLOY CLOUD SYNC</button>
    </div>
</nav>

<main class="max-w-7xl mx-auto px-6 py-20">
    <section class="grid grid-cols-1 lg:grid-cols-12 gap-16 items-center mb-32">
        <div class="lg:col-span-7">
            <h1 class="text-6xl font-extrabold mb-8 leading-tight">Clinical Intelligence.<br><span class="opacity-30">Strategically Engineered.</span></h1>
            <p class="text-lg font-medium mb-10 opacity-70">Leading Business Intelligence at <span class="underline">Accenture</span>. Specialist in enterprise-scale data modeling.</p>
            <div class="flex gap-4 mb-10">
                <a id="resume-link" href="#" class="apple-button">Get Master Resume</a>
                <input type="file" id="res-up" class="hidden" onchange="previewFile(this, 'resume-link', true)">
                <button onclick="document.getElementById('res-up').click()" class="admin-only text-[10px] font-bold">Update PDF</button>
            </div>
        </div>
        <div class="lg:col-span-5">
            <div class="portrait-frame">
                <img id="p-img" src="https://via.placeholder.com/500x700" alt="Profile">
                <div class="mgmt-hub admin-only-flex">
                    <button onclick="document.getElementById('p-up').click()" class="bg-white text-black px-4 py-2 rounded-full text-xs font-bold">Replace Photo</button>
                </div>
                <input type="file" id="p-up" class="hidden" onchange="previewFile(this, 'p-img')">
            </div>
        </div>
    </section>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
        <div class="apple-card">
            <div class="visual-viewport">
                <img id="p1-img" src="https://via.placeholder.com/800x500" class="hidden">
                <div class="mgmt-hub admin-only-flex">
                    <button onclick="document.getElementById('p1-up').click()" class="bg-white text-black px-4 py-2 rounded-full text-xs font-bold">Upload Project</button>
                </div>
            </div>
            <input type="file" id="p1-up" class="hidden" onchange="previewFile(this, 'p1-img')">
            <h5 class="text-2xl font-bold">Video Games Forecast 2030</h5>
        </div>
    </div>
</main>

<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js';
    import { getFirestore, doc, setDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js';
    import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-storage.js';

    const firebaseConfig = {
        apiKey: "AIzaSyBfo4tvtYF-mB8GP5GG7ElN7r_g8z94qQ0",
        authDomain: "bi-developer-portfolio.firebaseapp.com",
        projectId: "bi-developer-portfolio",
        storageBucket: "bi-developer-portfolio.appspot.com",
        messagingSenderId: "361759112211",
        appId: "1:361759112211:web:0dbebef7db5499768953e6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const docId = 'main-portfolio';

    // Helper: Upload file to Storage and return URL
    async function uploadFile(file, folder) {
        if (!file) return null;
        const storageRef = ref(storage, `${folder}/${Date.now()}_${file.name}`);
        const snapshot = await uploadBytes(storageRef, file);
        return await getDownloadURL(snapshot.ref);
    }

    // Save to Cloud Logic
    window.saveToCloud = async function() {
        const btn = document.getElementById('save-btn');
        btn.innerText = "UPLOADING ASSETS...";
        btn.disabled = true;

        try {
            // Check for new files selected in inputs
            const pFile = document.getElementById('p-up').files[0];
            const p1File = document.getElementById('p1-up').files[0];
            const resFile = document.getElementById('res-up').files[0];

            // Upload and get URLs, otherwise keep existing
            const pUrl = pFile ? await uploadFile(pFile, 'portraits') : document.getElementById('p-img').src;
            const p1Url = p1File ? await uploadFile(p1File, 'projects') : document.getElementById('p1-img').src;
            const resUrl = resFile ? await uploadFile(resFile, 'resumes') : document.getElementById('resume-link').href;

            const payload = {
                portrait: pUrl,
                p1_img: p1Url,
                resume: resUrl,
                updatedAt: Date.now()
            };

            await setDoc(doc(db, 'content', docId), payload);
            alert("PORTFOLIO SYNCED TO CLOUD");
            document.body.classList.remove('is-admin');
        } catch (e) {
            console.error(e);
            alert("Sync Failed: " + e.message);
        } finally {
            btn.innerText = "DEPLOY CLOUD SYNC";
            btn.disabled = false;
        }
    };

    // Load Data Logic
    onAuthStateChanged(auth, (user) => {
        if (user) {
            onSnapshot(doc(db, 'content', docId), (snap) => {
                if (snap.exists()) {
                    const data = snap.data();
                    if(data.portrait) document.getElementById('p-img').src = data.portrait;
                    if(data.p1_img) {
                        document.getElementById('p1-img').src = data.p1_img;
                        document.getElementById('p1-img').classList.remove('hidden');
                    }
                    if(data.resume) document.getElementById('resume-link').href = data.resume;
                }
                document.getElementById('loading-overlay').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-overlay').style.display = 'none', 600);
            });
        }
    });

    signInAnonymously(auth);
</script>

<script>
    let clickCount = 0;
    function handleLockClick() {
        clickCount++;
        if (clickCount >= 3) { document.body.classList.toggle('is-admin'); clickCount = 0; }
    }
    function toggleTheme() { document.body.classList.toggle('dark-mode'); }
    function previewFile(input, targetId, isLink = false) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const el = document.getElementById(targetId);
                if (isLink) el.href = e.target.result;
                else { el.src = e.target.result; el.classList.remove('hidden'); }
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
</body>
</html>
